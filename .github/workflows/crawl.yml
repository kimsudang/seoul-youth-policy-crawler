name: ğŸ”„ Crawl and Commit Youth Policies

on:
  schedule:
    - cron: '0 0 * * *' # ë§¤ì¼ ìì • (UTC ê¸°ì¤€ = ì˜¤ì „ 9ì‹œ KST)
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼ë„ GitHub UIì— í‘œì‹œë¨

permissions:
  contents: write

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ¤– Run playwright crawl script
        run: node scripts/crawl.js

      - name: ğŸ’¾ Commit and push if data changed
        run: |
          git config user.name "${{ github.actor }}"
          git config user.email "${{ github.actor }}@users.noreply.github.com"

          git pull origin main

          git add data/policy-list.json

          # ë³€ê²½ëœ ë‚´ìš©ì´ ìˆë‹¤ë©´ ì»¤ë°‹
          git diff --cached --quiet || (git commit -m "ğŸ”„ ìë™ í¬ë¡¤ë§ ë°ì´í„° ì—…ë°ì´íŠ¸" && git push)
